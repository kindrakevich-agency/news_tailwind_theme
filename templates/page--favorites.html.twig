{#
/**
 * @file
 * Theme implementation for the favorites page.
 *
 * This page displays articles that the user has collected/favorited.
 * Articles are loaded via JavaScript based on localStorage.
 */
#}
<!DOCTYPE html>
<html{{ html_attributes }}>
  <head>
    <head-placeholder token="{{ placeholder_token }}">
    <title>{{ head_title|safe_join(' | ') }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <css-placeholder token="{{ placeholder_token }}">
    <js-placeholder token="{{ placeholder_token }}">
  </head>
  <body{{ attributes }}>
    <a href="#main-content" class="visually-hidden focusable skip-link">
      {{ 'Skip to main content'|t }}
    </a>
    {{ page_top }}

    <!-- Header -->
    {% include '@news_theme/includes/header-menu.html.twig' %}
    {% include '@news_theme/includes/header-tags.html.twig' with {'tags': tags, 'current_term': null} %}

    <!-- Filter Buttons - Main Menu -->
    {% if main_menu_items %}
        <div class="max-w-7xl mx-auto mt-6">
            <div class="flex space-x-2 overflow-x-auto scrollbar-hide pb-2">
                {% for item in main_menu_items %}
                    {% set is_first = loop.first %}
                    <a href="{{ item.url }}" class="px-4 py-2 {{ item.is_active ? 'bg-gray-200 text-gray-900' : 'bg-white text-gray-700' }} text-sm rounded-full border border-gray-300 hover:bg-gray-50 whitespace-nowrap {{ is_first ? 'ml-4' : '' }}">
                        {{ item.title }}
                    </a>
                {% endfor %}
            </div>
        </div>
    {% endif %}

    <!-- Exchange Rates -->
    {% include '@news_theme/includes/exchange-rates.html.twig' with {
        'exchange_rates': exchange_rates
    } %}

    <!-- Main Content -->
    <div id="favorites-content" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-8">
        <!-- Loading message -->
        <div id="favorites-loading" class="text-center py-12">
            <p class="text-gray-500 dark:text-gray-400">{{ 'Loading favorites...'|t }}</p>
        </div>

        <!-- Empty state -->
        <div id="favorites-empty" class="hidden text-center py-12">
            <svg class="w-16 h-16 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
            </svg>
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">{{ 'No favorites yet'|t }}</h2>
            <p class="text-gray-500 dark:text-gray-400 mb-6">{{ 'Start collecting articles by clicking the "Collect" button'|t }}</p>
            <a href="{{ path('<front>') }}" class="inline-block px-6 py-3 bg-teal-600 text-white rounded-md hover:bg-teal-700">
                {{ 'Browse articles'|t }}
            </a>
        </div>

        <!-- Articles grid -->
        <div id="favorites-list" class="masonry hidden">
            <!-- Articles will be loaded here via JavaScript -->
        </div>
    </div>

    <!-- Footer -->
    {% include '@news_theme/includes/footer.html.twig' %}

    {{ page_bottom }}
    <js-bottom-placeholder token="{{ placeholder_token }}">

    <script>
    (function() {
        // Get favorites from localStorage
        function getFavorites() {
            const favorites = localStorage.getItem('news_favorites');
            return favorites ? JSON.parse(favorites) : [];
        }

        // Load favorites on page load
        const favorites = getFavorites();
        const loading = document.getElementById('favorites-loading');
        const empty = document.getElementById('favorites-empty');
        const list = document.getElementById('favorites-list');

        if (favorites.length === 0) {
            // Show empty state
            loading.classList.add('hidden');
            empty.classList.remove('hidden');
        } else {
            // Load articles via AJAX
            fetch('{{ base_path }}favorites/api?nids=' + favorites.join(','))
                .then(response => response.json())
                .then(data => {
                    loading.classList.add('hidden');

                    if (data.articles && data.articles.length > 0) {
                        list.classList.remove('hidden');
                        list.innerHTML = data.articles.join('');

                        // Re-attach Drupal behaviors for the new content
                        if (typeof Drupal !== 'undefined' && Drupal.attachBehaviors) {
                            Drupal.attachBehaviors(list);
                        }
                    } else {
                        empty.classList.remove('hidden');
                    }
                })
                .catch(error => {
                    console.error('Error loading favorites:', error);
                    loading.classList.add('hidden');
                    empty.classList.remove('hidden');
                });
        }
    })();
    </script>
  </body>
</html>
